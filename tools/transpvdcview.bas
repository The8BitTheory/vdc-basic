#RetroDevStudio.MetaData.BASIC:7169,BASIC V7.0 VDC,uppercase,10,10
# TRANSFORMS BITMAP INTO VDC-FILE WITH TRANSPARENCY
# THE TRANSPARENCY IS JUST A RESULT OF COMPLEX METADATA THAT
#  TELLS VDC-BASIC WHICH BYTES TO LEAVE OUT

# 4.64 MINUTES WRITING TO VRAM
# 4.16 MINUTES POKING AND THEN WRITING TO VRAM

# LOAD VDC-FILE
# - COPY IMAGE-DATA TO VRAM --> START AND END (OR SIZE) OF IMAGE DATA NEEDED
# - COPY META-DATA TO SOMEWHERE ELSE IN RAM --> SIZE NEEDED

# VDC FILE FORMAT (FOR FILES WITH TRANSPARENCY)
# - METADATA-LENGTH: 2 BYTES
# - IMAGEDATA-LENGTH: 2 BYTES (IMAGEDATA START IS AFTER METADATA-SIZE)
# - METADATA
# - IMAGEDATA



10 GRAPHIC 0
# DEFINE FUNCTIONS
20 DEF FN W(ZZ)=PEEK(ZZ)+PEEK(ZZ+1)*256
30 BS=FN W(45)
40 BE=FN W(4624)
# DB=DATA BEGIN
# DE=DATA END
50 DB=BE:DE=DB+8000

60 PRINT "BASIC FROM "BS" TO "BE"."
70 PRINT "LEAVES "FRE(0)" BYTES FREE."
80 DD=PEEK(186)

90 PRINT "PRESS R TO USE VDCBASIC FROM RAM":GETKEY I$
95 IF I$="R" THEN 110

100 BLOAD "VDCBASIC2F.1300",B0,U(DD)

110 SYS DEC("1300")

120 AP=8000:DISP 32000

# 2 SCANLINES PER CHAR, 160 SCANLINES (EACH VAL +1)
130 RGW 0,127:RGW 4,155:RGW 6,100:RGW 7,140:RGW 9,1
140 RGO 25,128:REM BITMAP MODE ON
150 RGO 28,2î¸ž4:REM 64K VRAM
160 RGW 36,0
170 RGW DEC("1A"),DEC("FF")

180 VMF 32000,15,16000:REM SETUP PIXELS
190 VMF 0,0,16000: REM CLEAR ATTRIBUTE RAM
200 ATTR 8000:BANK 0

210 BLOAD"LANDSCAPE.VDC",B0,P(BE),U(DD)
220 RTV BE,16000,8000

240 PF$="OUT.VT"
250  GOSUB 290

280 BANK15:END


290 PRINT "LOADING "PF$" ... ";

300 BLOAD (PF$),B0,P(DB),U(DD):PRINT"DONE"

305 PRINT "DATA-BEGIN:"HEX$(DB)
310 ML=PEEK(DB)+PEEK(DB+1)*256
315 PRINT "METADATA-LENGTH:"ML
320 IL=PEEK(DB+2)+PEEK(DB+3)*256
325 PRINT "IMAGEDATA-LENGTH:"IL
330 RTV DB+ML,24000,IL
335 SP=DB+4:TA=30+4000:ATTR 0:AP(0)=0:AP(1)=8000:AX=0

339 FAST:DO
#    BACKUP SPRITE BACKGROUND
#340  VMC TA,AP+4000,13,30,
350  S=TI:VMC 16000,AP(AX),8000:VMS 24000,AP(AX)+TA,SP:S=TI-S
355  ATTR AP(AX)

400  GETKEY I$
405  PT=TA
410  IF I$="I" THEN TA=TA-80:IF TA<0 THEN TA=0
420  IF I$="K" THEN TA=TA+80:IF TA>5600 THEN TA=5600
430  IF I$="J" THEN TA=TA-1:IF TA<0 THEN TA=0
440  IF I$="L" THEN TA=TA+1:IF TA>5600 THEN TA=5600

445  AX=ABS(ABS(AX)-1)

#445  PRINT TA
450 LOOP UNTIL I$="X":SLOW
